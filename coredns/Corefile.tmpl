# Generated by docker-gen
# This file will be regenerated when containers are started or stopped
# DO NOT EDIT MANUALLY

. {
    hosts /hosts {
        fallthrough
    }
    reload 1s
    log
    errors
    cache 30
}

# Dynamic upstream servers for services with VIRTUAL_HOST
{{ range $host, $containers := groupByMulti $ "Env.VIRTUAL_HOST" "," }}
{{ $host }}:53 {
    log
    forward . {{ range $i, $value := $containers }}{{ if $i }} {{ end }}{{ $value.IP }}{{ end }}
}
{{ end }}

# Auto-discovered containers
{{ range $container := $ }}
{{ if $container.IP }}{{ $container.Name | replace "/" "" }}.docker.local {
    log
    forward . {{ $container.IP }}
}
{{ end }}{{ end }}
